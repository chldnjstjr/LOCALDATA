[["index.html", "공공데이터 전처리 가이드 Chapter 1 Index", " 공공데이터 전처리 가이드 WON SEOK CHOI 2023-04-27 Chapter 1 Index bookdown::serve_book() "],["개요.html", "Chapter 2 개요 2.1 제목 (가칭) 2.2 두 줄 요약 2.3 목표 2.4 범위 2.5 절차 2.6 도구 2.7 기간 2.8 인원", " Chapter 2 개요 2.1 제목 (가칭) BRIG Business Research and Insights by Gallup Korea 2.2 두 줄 요약 분석을 위한 공공데이터 전처리 방법 공유 공공데이터를 활용한 시장 트렌드 분석 보고서 작성 2.3 목표 공공데이터를 활용하여 시장과 산업에 대한 통계 및 인사이트 제공 2.4 범위 문제 정의 데이터 관련 데이터 수집 데이터 전처리 기술통계, 시각화 및 기타 기술을 통해 데이터를 탐색하여 패턴, 추세 및 관계를 식별 보고서 데이터 분석 결과를 토대로 마케팅 인사이트 도출 전처리 과정과 분석 보고서 공유 2.5 절차 데이터 수집→ 전처리 및 분석 → 보고서 작성 및 공유 2.6 도구 R Github 2.7 기간 21일 : 2023.04.09. (일) ~ 2023.04.30. (일) 근무 시간 중 (09:00-18:00)에는 가장 후순위 다른 업무가 전혀 없는 경우에만 본 프로젝트 수행 프로젝트에 필요한 대부분의 시간은 정규 근무 시간 외 또는 주말 2.8 인원 참여 인력 및 역할: 1명 최원석 연구원: PM / 데이터 수집 및 전처리 / 인사이트 리포트 작성 "],["배경.html", "Chapter 3 배경 3.1 왜 이런 것을 하게 되었나?", " Chapter 3 배경 3.1 왜 이런 것을 하게 되었나? 요약: 고객사의 요청 부서 내 조사 프로젝트 중 한 고객사가 전국 헬스장의 위치와 연도 별 추이 통계를 요청함. 가장 경제적으로 고객사의 요구사항을 충족시킬 수 있는 방법 고안 무료 공공데이터 활용 부서 내 연구원이 직접 처리함으로써 타 부서 또는 협력 업체와 의사소통에 소요되는 시간 X 고객사의 0순위 니즈를 충족시켜주자! 신규 제품 및 서비스, 더 넓게는 신사업을 추진하는 과정에서 가장 먼저 필요한 것은 진출하고자 하는 시장의 현황 분석임. 한국갤럽의 고객사 중 자체적인 시장조사와 분석에 어려움을 겪어 수주한 조사와 함께 요청하는 경우가 많음. 시장 규모, 잠재고객 규모, 경쟁 업체 수, 특정 제품군의 소비자 수 추정치 등 고객사의 시장조사에 대한 니즈가 분명함에도 불구하고 한국갤럽만의 뚜렷한 `Solution`이 존재하지 않음. 고객사가 겪는 시장조사의 어려움에 대한 기술적인 해결책을 제시할 목적으로 본 프로젝트를 수행하게 됨. 고객사는 지방인허가데이터가 왜 필요할까? 담배소매업 예시) 담배제조사에게 담배소매점은 소비자에게 자사 제품이 전달되는 마지막 채널 각 지역별 담배소매업 현황을 파악하여 판매량 예측 또는 판매량에 따른 대응 가능 특정 지역에서 지역에서 담배 판매량이 낮은 경우 소매업 현황 파악하여 원인 찾고 개선 방안 모색 담배제조사는 담배제품 유통을 담당하는 담배도소매 업체와 협력하여 제품을 유통시켜야함. 이를 위해 각 지역의 유통 특성을 파악해야함. 지역별 담배소매업체의 위치, 수량, 경쟁 업체와 비교, 매출액 등 다른 데이터들과 함께 결합하여 분석하는 것을 통해 효과적인 제품 유통 전략을 수립하고 도소매 업체에게 공유하여 협력관계를 유지하거나 개선할 수 있음. 각 지역의 특성과 소비자 선호도 등을 파악하여 마케팅 전략을 수립 지방인허가데이터로 제공되는 병원, 미용실, 대형마트, 음식점 등 다른 업종에도 적용 가능 "],["목표-1.html", "Chapter 4 목표 4.1 프로젝트의 목표 정의 4.2 목표 달성을 위한 계획 4.3 기대효과", " Chapter 4 목표 4.1 프로젝트의 목표 정의 연도에 따른 업종별 인허가 수 추이 파악 부서 내 프로젝트 활용 현재 진행 중인 마케팅 4실의 프로젝트에 적용 1990년~2022년 추이: 전국 체력단련장업 수 / 증감률 / 개업&amp;폐업 추이 기타 프로젝트 활용 가능성 제고 체력단련장업 외 한국갤럽 프로젝트와 관련된 업종의 연도별 추이 파악 타 부서(사회조사 포함)에서도 활용 가능하도록 최대한 많은 업종에 기술 적용 데이터 시각화 고객사 또는 조사 결과 보고서 내 쉽게 첨부할 수 있는 간편한 도구 개발 인사이트 비즈니스 인사이트 4.2 목표 달성을 위한 계획 기획 및 설계: 2023년 4월 8일 ~ 2023년 4월 9일 (2일) 구현: 2023년 4월 10일 ~ 2023년 4월 26일 (17일) 데이터 로드 및 전처리 체력단련업 외 부서 프로젝트 관련 업종 1개 (담배소매업) 각 업종의 .xlsx 파일 다운로드 폐업, 휴업 시기에 대한 결측치 처리 폐업, 휴업 결측치의 경우 해당 시기에 대한 기준 마련 조사 시점 등으로 대체 분석 최종 결과 도출 (R code base) 기능 테스트 및 디버깅 체력단련업 외 1개 업종 데이터셋에 적용 시각화 Flexdashboard 또는 leaflet 라이브러리 활용한 대시보드, 지도 구현 (R) 이미지 파일(.png)로 추출 보고서 작성: 2023년 4월 27일 ~ 2023년 4월 28일 (2일) 정기간행물 작성 목차 및 분량 구성 주간/월간/연간 양식 구성 예시 (바이브컴퍼니 - 썸트렌드) 공유 문서 작성: 2023년 4월 29일 (1일) 4.3 기대효과 한 번의 조사 수행 과정 관점 고객사의 부족한 시장 조사 및 분석 보완 통계 수집, 그래프 제작 과정의 소요 시간 단축 조직 내부 관점 기술 내재화 방대한 양의 지방인허가데이터(공공데이터)를 데이터를 다룰 수 있는 기술을 확보함. 파이프라인 구축 동일한 방식으로 홈페이지에 공개된 방대한 데이터를 필요에 따라 시각화 가능함. 근로 시간 효율성 제고 불필요한 업무 시간을 줄임으로써 설문지 설계 등 더 중요한 업무에 더 많은 업무 시간을 사용할 수 있음. 인사이트 제공 ‘BRIG’ 리포트를 통해 연구 부서 구성원을 중심으로 비즈니스 인사이트 제공 대외적 관점 기사 노출 빈도 제고 사회적 이슈 발생 시 특정 통계를 중심으로 작성되는 기사 많음. KB금융 “헬스장 1만개…‘덤벨 이코노미’ 시대 지속 성장 가능” 충북 “2026년까지 합계출산율 1.4명 달성할 것” 주기적으로 리포트를 배포함으로써 기사에 인용되는 빈도를 제고할 수 있음. 오픈소스 시장 현황에 대한 분석에 대한 니즈는 분야를 막론함. 공공데이터를 적절히 가공한 데이터를 공개함으써 공공에 기여함. 기사, 학술, 주식 분석 리포트 등 "],["전략-및-방법.html", "Chapter 5 전략 및 방법", " Chapter 5 전략 및 방법 수행을 위한 전략 그런거 없음. 그냥 밀고 간다! 활용 자료 2차 자료(Secondary data): 지방인허가 데이터 문헌조사(Literature review): 인사이트 도출을 위한 논문, 도서 리뷰 프로젝트 실행을 위한 리소스 및 인력 계획 지방인허가데이터 (LOCALDATA) 전국 지방자치단체에 50여 년 동안 축적된 각종 인허가 데이터로, 국민 경제활동과 밀접한 건강·문화·생활·식품 등의 정보를 선별해서 DB화하여 파일형태로 제공 상세 내용(Click, Click) 인력 1명 최원석 연구원 "],["분석.html", "Chapter 6 분석 6.1 준비 6.2 연도별 체력단련업 추이", " Chapter 6 분석 6.1 준비 6.1.1 데이터 체력단련업 홈페이지에서 직접 다운로드 지방인허가데이터의OPEN API는 ’변동분 자료’만 호출이 가능하며, 전체 자료는 직접 다운로드해야함(안내). 6.1.2 라이브러리 library(pacman) p_load(readxl, dplyr, lubridate, ggplot2, sf, maps, stringr, plotly) readxl: read_xlsx 함수 사용을 위한 패키지 dplyr: %&gt;%, select, summarise 함수 사용을 위한 패키지 lubridate: year 함수 사용을 위한 패키지 ggplot2: ggplot 함수 사용을 위한 패키지 sf: st_as_sf, st_transform 함수 사용을 위한 패키지 maps: plotly: plot_ly 함수 사용을 위한 패키지 6.1.3 데이터 불러오기 6.1.4 전처리 #날짜 뒤 시간 제거 df$최종수정시점 &lt;- as.Date(df$최종수정시점, format = &quot;%Y-%m-%d&quot;) #날짜 형태로 변환 - 연도 파생 변수 추출 목적 df[, c(&quot;인허가일자&quot;, &quot;폐업일자&quot;, &quot;휴업시작일자&quot;, &quot;인허가취소일자&quot;, &quot;최종수정시점&quot;)] &lt;- lapply(df[, c(&quot;인허가일자&quot;, &quot;폐업일자&quot;, &quot;휴업시작일자&quot;, &quot;인허가취소일자&quot;,&quot;최종수정시점&quot;)], as.Date) #연도만 나타내는 파생변수 추가 df[, c(&quot;인허가연도&quot;, &quot;폐업연도&quot;, &quot;휴업시작연도&quot;, &quot;인허가취소연도&quot;,&quot;최종수정연도&quot;)] &lt;- lapply(df[, c(&quot;인허가일자&quot;, &quot;폐업일자&quot;, &quot;휴업시작일자&quot;, &quot;인허가취소일자&quot;,&quot;최종수정시점&quot;)], year) df1 &lt;- df %&gt;% select(&quot;번호&quot;, &quot;사업장명&quot;, &quot;영업상태구분코드&quot;, &quot;상세영업상태명&quot;, &quot;인허가연도&quot;, &quot;폐업연도&quot;, &quot;휴업시작연도&quot;, &quot;인허가취소연도&quot;, &quot;최종수정연도&quot;, &quot;좌표정보(X)&quot;, &quot;좌표정보(Y)&quot;) 6.1.4.1 결측치 6.1.4.1.1 변수 영업상태구분코드 - 영업상태명 01: 영업/정상 02: 휴업 03: 폐업 04: 취소/말소/만료/정지/중지 6.1.4.1.2 Cases 만약 영업 중인 점포(CODE:01)라면 폐업일자, 휴업일자 NA 확인결과 Okay #영업 중이면 폐업, 휴업일자가 없어야함. df1 %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% summarise(&quot;영업 중이면 모두 폐업일자가 없는가?&quot;=sum(is.na(폐업연도))==nrow(.)) #없음 ## # A tibble: 1 × 1 ## `영업 중이면 모두 폐업일자가 없는가?` ## &lt;lgl&gt; ## 1 TRUE df1 %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% summarise(&quot;영업 중이면 모두 휴업시작일자가 없는가?&quot;=sum(is.na(휴업시작연도))==nrow(.)) #없음 ## # A tibble: 1 × 1 ## `영업 중이면 모두 휴업시작일자가 없는가?` ## &lt;lgl&gt; ## 1 TRUE 폐업한 점포라면 폐업일자가 있어야함. 만약 폐업점포이지만 폐업일자가 결측치(NA)라면 최종수정시점으로 대체 #폐업 매장의 결측치 확인 df1 %&gt;% filter(영업상태구분코드==&quot;03&quot;, is.na(폐업연도)) ## # A tibble: 58 × 11 ## 번호 사업장명 영업상태구분코드 상세영업상태명 인허가연도 폐업연도 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 247 Secret 휘트니스클럽 03 폐업 2011 NA ## 2 2496 에벤에셀 헬스그럽 03 폐업 2001 NA ## 3 4694 에너지프러스(74) 03 폐업 1999 NA ## 4 4695 YOUNG &amp;POWER헬스클… 03 폐업 1999 NA ## 5 4751 신사헬스크럽(39) 03 폐업 1999 NA ## 6 4803 Trainer Jin Diehar… 03 폐업 2012 NA ## 7 4909 패트릭헬스짐(87) 03 폐업 2000 NA ## 8 4911 (주)테크노짐(90) 03 폐업 2000 NA ## 9 6154 사직체력관 03 폐업 1989 NA ## 10 6155 올림픽헬스 03 폐업 1996 NA ## # ℹ 48 more rows ## # ℹ 5 more variables: 휴업시작연도 &lt;dbl&gt;, 인허가취소연도 &lt;dbl&gt;, ## # 최종수정연도 &lt;dbl&gt;, `좌표정보(X)` &lt;chr&gt;, `좌표정보(Y)` &lt;chr&gt; df1 &lt;- df1 %&gt;% mutate(폐업연도 = if_else(영업상태구분코드==&quot;03&quot; &amp; !is.na(폐업연도), 폐업연도, if_else(영업상태구분코드==&quot;03&quot; &amp; is.na(폐업연도), 최종수정연도, NA))) #확인 df1 %&gt;% filter(영업상태구분코드==&quot;03&quot;, is.na(폐업연도)) ## # A tibble: 0 × 11 ## # ℹ 11 variables: 번호 &lt;chr&gt;, 사업장명 &lt;chr&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 상세영업상태명 &lt;chr&gt;, 인허가연도 &lt;dbl&gt;, 폐업연도 &lt;dbl&gt;, 휴업시작연도 &lt;dbl&gt;, ## # 인허가취소연도 &lt;dbl&gt;, 최종수정연도 &lt;dbl&gt;, 좌표정보(X) &lt;chr&gt;, ## # 좌표정보(Y) &lt;chr&gt; 휴업한 점포라면 휴업시작일자가 있어야함. 만약 휴업점포이지만 휴업일자가 결측치(NA)라면 최종수정시점으로 대체 #휴업 매장의 결측치 확인 df1 %&gt;% filter(영업상태구분코드==&quot;02&quot;, is.na(휴업시작연도)) ## # A tibble: 13 × 11 ## 번호 사업장명 영업상태구분코드 상세영업상태명 인허가연도 폐업연도 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 14790 운동가짐 02 휴업 2016 NA ## 2 14791 라운지 필라테스 02 휴업 2017 NA ## 3 14792 가이앤걸스핏 운동… 02 휴업 2014 NA ## 4 14793 동호헬스클럽 02 휴업 1996 NA ## 5 14794 올림피아헬스클럽 02 휴업 1998 NA ## 6 14795 신장여성헬스 02 휴업 1998 NA ## 7 14796 프라임헬스클럽 02 휴업 2001 NA ## 8 14797 하남여성헬스 02 휴업 2002 NA ## 9 14798 스파르타짐 02 휴업 2010 NA ## 10 16348 보은헬스 02 휴업 1995 NA ## 11 16415 라벤더헬스 02 휴업 2016 NA ## 12 21555 미스미스터헬스 02 휴업 2000 NA ## 13 21556 국성체력관리원 02 휴업 1993 NA ## # ℹ 5 more variables: 휴업시작연도 &lt;dbl&gt;, 인허가취소연도 &lt;dbl&gt;, ## # 최종수정연도 &lt;dbl&gt;, `좌표정보(X)` &lt;chr&gt;, `좌표정보(Y)` &lt;chr&gt; df1 &lt;- df1 %&gt;% mutate(휴업시작연도 = if_else(영업상태구분코드==&quot;02&quot; &amp; !is.na(휴업시작연도), 휴업시작연도, if_else(영업상태구분코드==&quot;02&quot; &amp; is.na(휴업시작연도), 최종수정연도, NA))) #확인 df1 %&gt;% filter(영업상태구분코드==&quot;02&quot;, is.na(휴업시작연도)) ## # A tibble: 0 × 11 ## # ℹ 11 variables: 번호 &lt;chr&gt;, 사업장명 &lt;chr&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 상세영업상태명 &lt;chr&gt;, 인허가연도 &lt;dbl&gt;, 폐업연도 &lt;dbl&gt;, 휴업시작연도 &lt;dbl&gt;, ## # 인허가취소연도 &lt;dbl&gt;, 최종수정연도 &lt;dbl&gt;, 좌표정보(X) &lt;chr&gt;, ## # 좌표정보(Y) &lt;chr&gt; ‘취소/말소/만료/정지/중지’ 점포 상세영업상태에 따라 상이 상세영업상태 폐업일자 인허가취소일자 등록취소 모든 매장 X 몇몇 매장 O 신고취소 모든 매장 X 모든 매장 O 지정취소 모든 매장 X 모든 매장 O 직권말소 몇몇 매장 X 모든 매장 X 허가취소 모든 매장 X 몇몇 매장 O 취소, 말소, 만료, 정지, 중지는 영업의 여집합으로 분류 -&gt; 즉, 영업을하지 않는 폐업과 같다고 가정. ‘취소/말소/만료/정지/중지’ 매장의 경우 인허가취소일자가 있다면 해당 변수를 폐업일자로, 없다면 최종수정시점으로 대체 해당 매장들의 경우 폐업일자가 모두 없는 것을 확인 #취소 매장의 결측치 확인 df1 %&gt;% filter(영업상태구분코드==&quot;04&quot;) %&gt;% summarise(sum(is.na(폐업연도))) #있음 ## # A tibble: 1 × 1 ## `sum(is.na(폐업연도))` ## &lt;int&gt; ## 1 1369 df1 &lt;- df1 %&gt;% mutate(폐업연도 = if_else(영업상태구분코드==&quot;04&quot; &amp; !is.na(인허가취소연도), 인허가취소연도, if_else(영업상태구분코드==&quot;04&quot; &amp; is.na(인허가취소연도), 최종수정연도, NA))) #다시 확인 df1 %&gt;% filter(영업상태구분코드==&quot;04&quot;&amp;is.na(폐업연도)) #없음 ## # A tibble: 0 × 11 ## # ℹ 11 variables: 번호 &lt;chr&gt;, 사업장명 &lt;chr&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 상세영업상태명 &lt;chr&gt;, 인허가연도 &lt;dbl&gt;, 폐업연도 &lt;dbl&gt;, 휴업시작연도 &lt;dbl&gt;, ## # 인허가취소연도 &lt;dbl&gt;, 최종수정연도 &lt;dbl&gt;, 좌표정보(X) &lt;chr&gt;, ## # 좌표정보(Y) &lt;chr&gt; 6.2 연도별 체력단련업 추이 6.2.1 연도별 헬스장 개수의 추이 폐업/휴업/취소한 연도에도 서류상 영업을 했다고 카운팅 인허가연도와 폐업/휴업/취소 연도가 같을 경우 해당 연도에 영업을 한 것으로 카운팅 # Create a vector of years from 1990 to 2023 years &lt;- 1990:2023 # Create a data frame to store the results Opening_df &lt;- data.frame(year = years, open_stores = rep(0, length(years))) # Loop through each year for (i in 1:length(years)) { # Count the number of open stores in the current year open_stores &lt;- sum(df1$인허가연도 &lt;= years[i] &amp; (is.na(df1$폐업연도) | df1$폐업연도 &gt;= years[i]) &amp; (is.na(df1$휴업시작연도) | df1$휴업시작연도 &gt;= years[i]) &amp; (is.na(df1$인허가취소연도) | df1$인허가취소연도 &gt;= years[i])) # Calculate the growth rate compared to the previous year growth_rate &lt;- ifelse(i == 1, 0, (open_stores - Opening_df[i-1, &quot;open_stores&quot;])/Opening_df[i-1, &quot;open_stores&quot;] * 100) # Store the results in the data frame Opening_df[i, &quot;open_stores&quot;] &lt;- open_stores Opening_df[i, &quot;growth_rate&quot;] &lt;- growth_rate } # Print the result Opening_df ## year open_stores growth_rate ## 1 1990 277 0.000000 ## 2 1991 352 27.075812 ## 3 1992 448 27.272727 ## 4 1993 576 28.571429 ## 5 1994 745 29.340278 ## 6 1995 843 13.154362 ## 7 1996 1161 37.722420 ## 8 1997 1507 29.801895 ## 9 1998 1853 22.959522 ## 10 1999 2323 25.364274 ## 11 2000 2763 18.941025 ## 12 2001 3354 21.389794 ## 13 2002 4174 24.448420 ## 14 2003 5315 27.335889 ## 15 2004 5968 12.285983 ## 16 2005 6620 10.924933 ## 17 2006 7131 7.719033 ## 18 2007 7593 6.478755 ## 19 2008 7984 5.149480 ## 20 2009 8354 4.634269 ## 21 2010 8805 5.398611 ## 22 2011 9256 5.122090 ## 23 2012 9810 5.985307 ## 24 2013 10308 5.076453 ## 25 2014 10999 6.703531 ## 26 2015 11875 7.964360 ## 27 2016 12750 7.368421 ## 28 2017 13563 6.376471 ## 29 2018 14397 6.149082 ## 30 2019 15289 6.195735 ## 31 2020 16336 6.848061 ## 32 2021 17887 9.494368 ## 33 2022 19861 11.035948 ## 34 2023 20224 1.827703 6.2.2 연도별 헬스장 인허가 &amp; 폐업 수 추이 # define the years from 1995 to 2023 years &lt;- seq(&quot;1955&quot;, &quot;2023&quot;, by = 1) # create an empty data frame to store the results result_df &lt;- data.frame(year = years, 인허가연도 = rep(0, length(years)), 폐업연도 = rep(0, length(years)), 휴업시작연도 = rep(0, length(years)), 인허가취소연도 = rep(0, length(years))) # loop through each year and calculate the frequency of the five variables for (i in 1:length(years)) { year &lt;- years[i] result_df[i, &quot;인허가연도&quot;] &lt;- sum(df1$인허가연도 == year) result_df[i, &quot;폐업연도&quot;] &lt;- sum(df1$폐업연도 == year, na.rm = T) result_df[i, &quot;휴업시작연도&quot;] &lt;- sum(df1$휴업시작연도 == year, na.rm = T) result_df[i, &quot;인허가취소연도&quot;] &lt;- sum(df1$인허가취소연도 == year, na.rm = T) } # print the results print(result_df) ## year 인허가연도 폐업연도 휴업시작연도 인허가취소연도 ## 1 1955 1 0 0 0 ## 2 1956 0 0 0 0 ## 3 1957 0 0 0 0 ## 4 1958 0 0 0 0 ## 5 1959 0 0 0 0 ## 6 1960 0 0 0 0 ## 7 1961 0 0 0 0 ## 8 1962 0 0 0 0 ## 9 1963 0 0 0 0 ## 10 1964 0 0 0 0 ## 11 1965 0 0 0 0 ## 12 1966 0 0 0 0 ## 13 1967 0 0 0 0 ## 14 1968 0 0 0 0 ## 15 1969 0 0 0 0 ## 16 1970 0 0 0 0 ## 17 1971 0 0 0 0 ## 18 1972 0 0 0 0 ## 19 1973 0 0 0 0 ## 20 1974 0 0 0 0 ## 21 1975 0 0 0 0 ## 22 1976 0 0 0 0 ## 23 1977 0 0 0 0 ## 24 1978 0 0 0 0 ## 25 1979 0 0 0 0 ## 26 1980 0 0 0 0 ## 27 1981 1 0 0 0 ## 28 1982 3 0 0 0 ## 29 1983 0 0 0 0 ## 30 1984 1 0 0 0 ## 31 1985 0 0 0 0 ## 32 1986 2 0 0 0 ## 33 1987 2 0 0 0 ## 34 1988 0 0 0 0 ## 35 1989 148 0 0 0 ## 36 1990 119 0 0 0 ## 37 1991 75 0 0 0 ## 38 1992 96 0 0 0 ## 39 1993 128 0 0 0 ## 40 1994 169 0 0 0 ## 41 1995 98 0 0 0 ## 42 1996 318 0 0 0 ## 43 1997 346 0 0 0 ## 44 1998 346 0 1 0 ## 45 1999 471 0 0 0 ## 46 2000 440 0 0 0 ## 47 2001 591 0 0 0 ## 48 2002 820 0 0 0 ## 49 2003 1141 0 1 0 ## 50 2004 654 0 0 0 ## 51 2005 652 1 0 0 ## 52 2006 512 1 1 1 ## 53 2007 464 0 2 0 ## 54 2008 393 16 0 0 ## 55 2009 386 19 0 1 ## 56 2010 470 32 1 1 ## 57 2011 484 19 2 0 ## 58 2012 575 42 0 1 ## 59 2013 540 40 2 1 ## 60 2014 733 71 1 0 ## 61 2015 948 64 2 5 ## 62 2016 941 72 1 1 ## 63 2017 886 45 0 0 ## 64 2018 879 213 3 0 ## 65 2019 1108 281 3 0 ## 66 2020 1331 210 13 3 ## 67 2021 1774 119 7 2 ## 68 2022 2100 102 5 1 ## 69 2023 470 22 2 0 result_df %&gt;% group_by(year) %&gt;% summarise(인허가연도, &quot;폐업/휴업/취소&quot;=폐업연도+휴업시작연도+인허가취소연도) ## # A tibble: 69 × 3 ## year 인허가연도 `폐업/휴업/취소` ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1955 1 0 ## 2 1956 0 0 ## 3 1957 0 0 ## 4 1958 0 0 ## 5 1959 0 0 ## 6 1960 0 0 ## 7 1961 0 0 ## 8 1962 0 0 ## 9 1963 0 0 ## 10 1964 0 0 ## # ℹ 59 more rows "],["시각화.html", "Chapter 7 시각화 7.1 지도 7.2 연도별 헬스장 인허가 &amp; 페업 수 추이", " Chapter 7 시각화 7.1 지도 7.1.1 좌표 (Coordinates) 지방인허가데이터의 좌표는 위도, 경도 좌표가 아님. 따라서 범용성을 위해 위경도 좌표로 변환 필요. 지방인허가데이터의 홈페이지 ’데이터 활용가이드’에서 좌표정보는 중부원점TM(EPSG:2097)이라고 소개됨. 그러나 제공되는 데이터에 해당 좌표정보로 지정하여 위도·경도 변환 시 오류 발생 구글맵, 네이버맵 등에서 나오는 위치와 200m 가량 차이 발생 EPSG:2097 → EPSG:5174 EPSG:5174(Bessel 1841, TM직각좌표계)로 지정해야 오류 최소화됨. 지방인허가데이터에서 사용자들에게 잘못된 정보 제공하는 것으로 추정 Issue: XY좌표값의 소수점이 호출하면서 표시되지 않는 문제 기존 문자(character) 타입인 변수를 as.numeric 함수로 변환하면서 정보 유실 엑셀 파일 자체에서 미리 숫자로 변환해놓으면 데이터 로드 시 유실 getOption() 함수를 통해 현재 표시되고 있는 소수점 자리수 확인(7이었음) 해당 옵션을 option()함수를 통해 15자리로 수정하면서 문제 해결 getOption(&quot;digits&quot;) ## [1] 7 options(digits = 15) coord &lt;- df1[,c(1,10,11)] #1열:번호 / 10열:X좌표값 / 11열: Y좌표값 coord &lt;- na.omit(coord) #좌표값이 없는 경우 삭제 point_localdb &lt;- st_as_sf(coord, coords = c(&#39;좌표정보(X)&#39;,&#39;좌표정보(Y)&#39;), crs = &#39;+proj=tmerc +lat_0=38 +lon_0=127.0028902777778 +k=1 +x_0=200000 +y_0=500000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43&#39;) #변경 후 좌표값의 좌표계 형식 지정(4326 = WGS84) point_localdb_tf &lt;- st_transform(point_localdb, crs = 4326) str(point_localdb_tf) ## sf [20,942 × 2] (S3: sf/tbl_df/tbl/data.frame) ## $ 번호 : chr [1:20942] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... ## $ geometry:sfc_POINT of length 20942; first list element: &#39;XY&#39; num [1:2] 127 37.6 ## - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:674] 65 66 70 97 110 119 135 185 186 187 ... ## ..- attr(*, &quot;names&quot;)= chr [1:674] &quot;65&quot; &quot;66&quot; &quot;70&quot; &quot;97&quot; ... ## - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot; ## - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA ## ..- attr(*, &quot;names&quot;)= chr &quot;번호&quot; df2 &lt;- left_join(df1, point_localdb_tf, by=&quot;번호&quot;) # 좌표 추출 및 변수 생성 df2$latitude &lt;- st_coordinates(df2$geometry)[, &quot;Y&quot;] df2$longitude &lt;- st_coordinates(df2$geometry)[, &quot;X&quot;] #아래는 EPSG:2097로 지정한 경우 #point_localdb &lt;- st_as_sf(coord, coords = c(&#39;좌표정보(X)&#39;,&#39;좌표정보(Y)&#39;), crs = &#39;+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43&#39;) 최종 파일 추출 df3 &lt;- subset(df2, select = -geometry) write.csv(df3,&quot;C:/Users/wschoi/Desktop/TOY/[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사/지방인허가데이터/헬스장_위도경도추가.csv&quot;, fileEncoding = &quot;cp949&quot;) Issue: geometry type의 벡터 추출 우선 텍스트(.csv) 파일로 추출하는 것으로 모면 ㅎㅎ Issue: 깨짐 df_done 파일 그대로 추출하면 깨짐. encoding 필요 fileEncoding = “cp949” 옵션 추가 7.1.2 Mapping 1만개가 넘어가는 장소를 맵에 업로드 하면 컴퓨터가 많이 아파함. #install.packages(&quot;leaflet&quot;) #install.packages(&quot;geojsonio&quot;) library(leaflet) library(geojsonio) df4 &lt;- df2 %&gt;% filter(df2$영업상태구분코드==&quot;01&quot;) %&gt;% select(longitude, latitude, 사업장명) %&gt;% na.omit() m &lt;- leaflet(df4) %&gt;% addProviderTiles(&quot;OpenStreetMap.Mapnik&quot;) %&gt;% # add map tiles addMarkers(lng = ~longitude, lat = ~latitude, popup = ~사업장명) # add markers with popups # display the map m 7.2 연도별 헬스장 인허가 &amp; 페업 수 추이 library(plotly) result_df %&gt;% group_by(year) %&gt;% summarise(인허가연도, &quot;폐업/휴업/취소&quot;=폐업연도+휴업시작연도+인허가취소연도) %&gt;% #폐업/휴업/취소 연도 합산 ggplot(aes(x = year)) + geom_line(aes(y = 인허가연도, color = &quot;인허가&quot;)) + geom_line(aes(y = `폐업/휴업/취소`, color = &quot;폐업/휴업/취소&quot;)) + labs(x = &quot;연도&quot;, y = &quot;개수&quot;, color = &quot;&quot;) + scale_color_manual(values = c(&quot;인허가&quot; = &quot;blue&quot;, &quot;폐업/휴업/취소&quot; = &quot;red&quot;)) + theme_bw() "],["응용.html", "Chapter 8 응용 8.1 데이터 8.2 목표 8.3 데이터 불러오기 8.4 전처리 8.5 분석", " Chapter 8 응용 8.1 데이터 담배소매업 국내에서 영업 중인 담배제조사 8.2 목표 담배 소매점의 트렌드와 전국 현황을 살펴본다 8.3 데이터 불러오기 제공되는 엑셀 파일은 3개의 시트로 나뉘어 있음. 각 시트를 호출하여 1개 데이터 프레임으로 합치는 작업 ▼ 8.4 전처리 #Remove time from the date ciga_df$최종수정시점 &lt;- as.Date(ciga_df$최종수정시점, format = &quot;%Y-%m-%d&quot;) ciga_df &lt;- ciga_df %&gt;% mutate(인허가취소일자 = ifelse(인허가취소일자 == &quot;2206-06-01&quot;, &quot;2018-08-31&quot;, 인허가취소일자)) ciga_df &lt;- ciga_df %&gt;% mutate(휴업시작일자 = ifelse(휴업시작일자 == &quot;1111-11-11&quot;, &quot;2008-03-04&quot;, 휴업시작일자)) ciga_df &lt;- ciga_df %&gt;% mutate(휴업종료일자 = ifelse(휴업종료일자 == &quot;1111-11-11&quot;, &quot;2008-03-04&quot;, 휴업종료일자)) #Convert to date format ciga_df[, c(&quot;인허가일자&quot;, &quot;폐업일자&quot;, &quot;휴업시작일자&quot;, &quot;인허가취소일자&quot;, &quot;최종수정시점&quot;)] &lt;- lapply(ciga_df[, c(&quot;인허가일자&quot;, &quot;폐업일자&quot;, &quot;휴업시작일자&quot;, &quot;인허가취소일자&quot;,&quot;최종수정시점&quot;)], as.Date) 유효성 점검 인허가일자 대한민국 정부 수립일(1948년 8월 15일) 이전은 모두 삭제 사업장명 삭제 케이스 영업 중인 매장은 폐업일자가 없음 -&gt; O 영업 중인 매장 중 일부 휴업일자가 있음 -&gt; X #인허가일자 결측치 확인 sum(is.na(ciga_df$인허가연도)) #2023년 3월 31일 기준 1,131개 결측치 존재 ## Warning: Unknown or uninitialised column: `인허가연도`. ## [1] 0 #인허가일자 결측치 처리 ciga_df &lt;- ciga_df[!is.na(ciga_df$인허가일자), ] #인허가일자가 있는 케이스만 골라내기 #인허가일자 범위 summary(ciga_df$인허가일자) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## &quot;1900-01-01&quot; &quot;2001-05-04&quot; &quot;2006-12-21&quot; &quot;2007-03-08&quot; &quot;2014-03-03&quot; &quot;2023-04-07&quot; 대한민국 정부 수립일 이전은 모두 삭제 대한민국 정부 수립일: 1948년 8월 15일 (참고) 당시 정부와 통계 당국은 지금과 매우 다른 조건과 방법으로 자료를 수집하고 분석했을 가능성 있음. 따라서 현재 통계 자료 대비 정부 수립일 이전 통계 자료에 대한 신뢰성 문제 존재함. 이전 통계 자료는 그 시대의 특성을 반영할 수는 있지만 현재 통계와 크게 다를 수 있기 때문에 인허가 일자가 정부 수립일 이전인 경우 모두 삭제함. 예시) 인허가일자가 1911년 1월 1일 -&gt; 당시 슈퍼가 지금의 슈퍼가 아닐 수 있음. 또한 인허가 일자가 1900년인 경우 일자가 상이하지 않고 모두 1900년 1월 1일인 것으로 보았을 때 오기 또는 타당하지 않은 통계라고 보았음. #인허가일자가 1950년대 미만인 케이스 선택 ciga_df %&gt;% filter(인허가일자 &lt; as.Date(&quot;1950-08-15&quot;)) ## # A tibble: 186 × 30 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 23195 담배소매업 11_43_02_P 3070000 201330702160… 1900-01-01 ## 2 23205 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 3 23206 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 4 23209 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 5 23213 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 6 23215 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 7 23216 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 8 23218 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 9 23331 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## 10 23333 담배소매업 11_43_02_P 3070000 201430702160… 1900-01-01 ## # ℹ 176 more rows ## # ℹ 24 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, … #대한민국 정부 수립일 이전 삭제 ciga_df &lt;- ciga_df[!ifelse(ciga_df$인허가일자 &lt; &quot;1948-08-15&quot;, TRUE, FALSE), ] 사업장명 NA 또는 “-”, “--” “상호없음”, “상호 없음”, “없음” 등 -&gt; “없”이라는 단어 들어간 경우 삭제 “울타리없는만두”, “번지없는주막”이라는 매장 -&gt; “없”이 들어가면서 6글자 미만인 경우 삭제 “없”이 들어간 케이스 모두 육안으로 확인하였음. 자신의 이름 석자 기타 등등 #결측치 확인 sum(is.na(ciga_df$사업장명)) #없음 ## [1] 0 #사업장명이 1글자인 경우 삭제 ciga_df &lt;- ciga_df %&gt;% filter(!str_length(사업장명) == 1) #사업장명이 2글자인 경우, 그 빈도가 3 이상인 경우 삭제 #library(stringr) freq &lt;- ciga_df[str_length(ciga_df$사업장명) == 2, &quot;사업장명&quot;] %&gt;% table() #문자열 길이가 2인 케이스 to_remove &lt;- names(freq[freq &gt; 2]) ciga_df &lt;- ciga_df[!(str_length(ciga_df$사업장명) == 2 &amp; ciga_df$사업장명 %in% to_remove), ] #&quot;없&quot;이 들어간 경우, 6글자 미만인 경우 삭제 ciga_df &lt;- ciga_df[!(grepl(&quot;없&quot;, ciga_df$사업장명) &amp; str_length(ciga_df$사업장명) &lt; 7),] #&quot;상호 없음&quot; 또는 &quot;상호명&quot; 또는 &quot;없음&quot; 이라는 단어 들어간 경우 삭제 ciga_df &lt;- ciga_df[!grepl(&quot;상호 없음|상호명|없음&quot;, ciga_df$사업장명), ] #&#39;없&#39; 케이스 확인 ciga_df[grep(&quot;없&quot;, ciga_df$사업장명), ] ## # A tibble: 14 × 30 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 7935 담배소매업 11_43_02_P 3020000 20103020095… 2010-11-02 ## 2 8097 담배소매업 11_43_02_P 3020000 20113020095… 2011-01-18 ## 3 8745 담배소매업 11_43_02_P 3020000 20083020095… 2008-11-21 ## 4 112157 담배소매업 11_43_02_P 3340000 20043340017… 2004-12-28 ## 5 116659 담배소매업 11_43_02_P 3350000 20183350112… 2018-07-11 ## 6 139444 담배소매업 11_43_02_P 3440000 20073440073… 2007-10-30 ## 7 236475 담배소매업 11_43_02_P 3700000 20113700078… 2011-04-01 ## 8 241880 담배소매업 11_43_02_P 3720000 20073720070… 2007-09-05 ## 9 242149 담배소매업 11_43_02_P 3720000 20073720070… 2007-02-09 ## 10 377193 담배소매업 11_43_02_P 4240000 20004240010… 1999-03-30 ## 11 433707 담배소매업 11_43_02_P 4640000 19984650000… 1998-10-20 ## 12 523393 담배소매업 11_43_02_P 5250000 20005250006… 2000-06-02 ## 13 541180 담배소매업 11_43_02_P 5370000 20125370165… 2012-06-08 ## 14 542794 담배소매업 11_43_02_P 5370000 20185370227… 2018-11-09 ## # ℹ 24 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, ## # 데이터갱신일자 &lt;chr&gt;, 업태구분명 &lt;lgl&gt;, `좌표정보(X)` &lt;chr&gt;, … 자기이름 석자 케이스 가장 빈도가 높은 성씨로 시작하는 3글자 조회 → 직접 확인 후 삭제 2015년 통계청 ’인구총조사’에 따르면 순위는 다음과 같음 순위 성씨 인구 1 김 10,689,959 2 이 7,306,828 3 박 4,192,074 4 최 2,333,927 5 정 2,151,879 6 강 1,176,847 7 조 1,055,567 8 윤 1,020,547 9 장 992,721 10 임 823,921 #슈퍼 또는 수퍼 또는 박가네 또는 마트가 포함되지 않으면서 #성씨 빈도 Top10으로 시작하는 3글자의 사업장명은 제외 ciga_df[str_length(ciga_df$사업장명) == 3 &amp; !grepl(&quot;(슈퍼|수퍼|박가네|마트)&quot;, ciga_df$사업장명) &amp; grepl(&quot;^(김|이|박|최|정|강|조|윤|장|임)&quot;, ciga_df$사업장명), &#39;사업장명&#39;] ## # A tibble: 4,134 × 1 ## 사업장명 ## &lt;chr&gt; ## 1 임꺽정 ## 2 이순례 ## 3 이포스 ## 4 정길환 ## 5 김재근 ## 6 정식품 ## 7 조경자 ## 8 이명자 ## 9 조양사 ## 10 이귀순 ## # ℹ 4,124 more rows #조건문 반대로 적용하여 ciga_df 다시 정의 ciga_df &lt;- ciga_df[!(str_length(ciga_df$사업장명) == 3 &amp; !grepl(&quot;(슈퍼|수퍼|박가네|마트)&quot;, ciga_df$사업장명) &amp; grepl(&quot;^(김|이|박|최|정|강|조|윤|장|임)&quot;, ciga_df$사업장명)),] 주소 테이블 Join ‘시도’와 ’시군구’ 테이블을 조인하여 지역 정보 추가 region_df &lt;- read_xlsx(&quot;C:/Users/wschoi/Desktop/TOY/[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사/지방인허가데이터/지역 테이블.xlsx&quot;) ciga_df &lt;- left_join(ciga_df, region_df[c(&quot;개방자치단체코드&quot;, &quot;시도명&quot;, &quot;시군구명&quot;)], by=&#39;개방자치단체코드&#39;) head(ciga_df) ## # A tibble: 6 × 32 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 1 담배소매업 11_43_02_P 3000000 2010300012905… 2010-11-30 ## 2 2 담배소매업 11_43_02_P 3000000 2011300012905… 2011-08-17 ## 3 3 담배소매업 11_43_02_P 3000000 2019300020205… 2019-07-08 ## 4 4 담배소매업 11_43_02_P 3000000 2019300020205… 2019-09-02 ## 5 5 담배소매업 11_43_02_P 3000000 2019300020205… 2019-08-19 ## 6 6 담배소매업 11_43_02_P 3000000 2019300020205… 2019-08-13 ## # ℹ 26 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, ## # 데이터갱신일자 &lt;chr&gt;, 업태구분명 &lt;lgl&gt;, `좌표정보(X)` &lt;chr&gt;, … #결측치 확인 sum(is.na(ciga_df$시도명)) ## [1] 0 sum(is.na(ciga_df$시군구명)) ## [1] 0 날짜 변수 전처리 영업 중 (영업상태구분코드 “01”) 매장 중 휴업시작일자가 있는 경우 일정 기간 휴업 후 현재는 정상영업하고 있는 매장임. 따라서 다른 처리 X #영업 중이면 폐업, 휴업일자가 없어야함. ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% summarise(&quot;영업 중이면 모두 폐업일자가 없는가?&quot;=sum(is.na(폐업일자))==nrow(.)) #없음 ## # A tibble: 1 × 1 ## `영업 중이면 모두 폐업일자가 없는가?` ## &lt;lgl&gt; ## 1 TRUE ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% summarise(&quot;영업 중이면 모두 휴업종료일자가 없는가?&quot;=sum(is.na(휴업종료일자))==nrow(.)) #없음 ## # A tibble: 1 × 1 ## `영업 중이면 모두 휴업종료일자가 없는가?` ## &lt;lgl&gt; ## 1 FALSE #전처리 결과 확인 ciga_df %&gt;% filter(ciga_df$영업상태구분코드==&quot;02&quot; &amp; !is.na(ciga_df$휴업시작일자)) #굳 ## # A tibble: 379 × 32 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 649 담배소매업 11_43_02_P 3000000 201230001290… 2012-07-30 ## 2 650 담배소매업 11_43_02_P 3000000 202030002020… 2020-09-17 ## 3 3756 담배소매업 11_43_02_P 3010000 200830101000… 2008-03-26 ## 4 3757 담배소매업 11_43_02_P 3010000 201230101000… 2012-09-20 ## 5 3758 담배소매업 11_43_02_P 3010000 201730101300… 2017-03-28 ## 6 3759 담배소매업 11_43_02_P 3010000 201830101520… 2018-12-18 ## 7 7035 담배소매업 11_43_02_P 3020000 201430200950… 2014-07-24 ## 8 9893 담배소매업 11_43_02_P 3030000 201930300910… 2019-11-20 ## 9 9894 담배소매업 11_43_02_P 3030000 200730301030… 2007-06-12 ## 10 14469 담배소매업 11_43_02_P 3040000 201930401900… 2019-07-17 ## # ℹ 369 more rows ## # ℹ 26 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, … 폐업매장 결측치 폐업매장 (영업상태구분코드 “03”)이지만 폐업일자가 없는 경우 폐업일자를 최종수정시점으로 대체 폐업매장이지만 폐업일자 있는 경우 → 정상이기 때문에 다른 처리 X #폐업 매장의 결측치 확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;03&quot;, is.na(폐업일자)) ## # A tibble: 7,598 × 32 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 11977 담배소매업 11_43_02_P 3040000 200130400730… 2001-10-04 ## 2 12003 담배소매업 11_43_02_P 3040000 200030400730… 1999-09-18 ## 3 12027 담배소매업 11_43_02_P 3040000 200130400730… 2001-05-30 ## 4 12098 담배소매업 11_43_02_P 3040000 200030400730… 1996-12-02 ## 5 12114 담배소매업 11_43_02_P 3040000 200030400730… 1994-04-15 ## 6 12488 담배소매업 11_43_02_P 3040000 200030400730… 1993-04-09 ## 7 12585 담배소매업 11_43_02_P 3040000 199830400730… 1998-12-28 ## 8 12660 담배소매업 11_43_02_P 3040000 200030400730… 1995-03-01 ## 9 13213 담배소매업 11_43_02_P 3040000 200230400730… 2002-04-22 ## 10 13257 담배소매업 11_43_02_P 3040000 200230400730… 2002-04-29 ## # ℹ 7,588 more rows ## # ℹ 26 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, … #폐업매장이지만 폐업일자가 없는 케이스에 대해 폐업일자를 최종수정일자로 대체 ciga_df &lt;- ciga_df %&gt;% mutate(폐업일자 = if_else(영업상태구분코드 == &quot;03&quot; &amp; !is.na(폐업일자), 폐업일자, if_else(영업상태구분코드 == &quot;03&quot; &amp; is.na(폐업일자), 최종수정시점, 폐업일자))) #확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;03&quot;, !is.na(폐업일자)) #388,681 ## # A tibble: 388,681 × 32 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 877 담배소매업 11_43_02_P 3000000 201930002020… 2019-08-26 ## 2 878 담배소매업 11_43_02_P 3000000 201930002020… 2019-09-11 ## 3 879 담배소매업 11_43_02_P 3000000 201930002020… 2019-08-19 ## 4 880 담배소매업 11_43_02_P 3000000 201930002020… 2019-03-04 ## 5 881 담배소매업 11_43_02_P 3000000 201930002020… 2019-04-09 ## 6 882 담배소매업 11_43_02_P 3000000 201930002020… 2019-05-16 ## 7 883 담배소매업 11_43_02_P 3000000 201930002020… 2019-04-25 ## 8 884 담배소매업 11_43_02_P 3000000 201930002020… 2019-05-16 ## 9 885 담배소매업 11_43_02_P 3000000 201930002020… 2019-05-10 ## 10 886 담배소매업 11_43_02_P 3000000 201930002020… 2019-05-03 ## # ℹ 388,671 more rows ## # ℹ 26 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, … 휴업 매장 결측치 확인 휴업 매장(영업상태구분코드 “02”)이지만 휴업시작일자가 없는 경우 최종수정시점으로 대체 휴업 매장이지만 휴업시작일자가 없고 휴업종료일자는 있는 경우 확인 #휴업 매장의 결측치 확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;02&quot;, is.na(휴업시작일자)) ## # A tibble: 38 × 32 ## 번호 개방서비스명 개방서비스아이디 개방자치단체코드 관리번호 인허가일자 ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt; ## 1 135409 담배소매업 11_43_02_P 3430000 20003430010… 2000-04-15 ## 2 135411 담배소매업 11_43_02_P 3430000 19913430010… 1991-09-25 ## 3 183986 담배소매업 11_43_02_P 3550000 20023550012… 2002-05-27 ## 4 195275 담배소매업 11_43_02_P 3590000 20043590011… 2004-05-13 ## 5 195276 담배소매업 11_43_02_P 3590000 20003590011… 2000-06-10 ## 6 195277 담배소매업 11_43_02_P 3590000 20003590011… 2000-04-28 ## 7 203926 담배소매업 11_43_02_P 3620000 20043620012… 2004-06-04 ## 8 203927 담배소매업 11_43_02_P 3620000 20043620012… 2004-07-23 ## 9 203928 담배소매업 11_43_02_P 3620000 19963620012… 1996-12-19 ## 10 235827 담배소매업 11_43_02_P 3700000 20023700009… 2002-12-16 ## # ℹ 28 more rows ## # ℹ 26 more variables: 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, ## # 영업상태명 &lt;chr&gt;, 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, ## # 폐업일자 &lt;date&gt;, 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, ## # 사업장명 &lt;chr&gt;, 최종수정시점 &lt;date&gt;, 데이터갱신구분 &lt;chr&gt;, … #휴업 매장이지만 휴업시작일자가 없는 경우 최종수정일자로 대체 ciga_df &lt;- ciga_df %&gt;% mutate(휴업시작일자=if_else(영업상태구분코드==&quot;02&quot; &amp; !is.na(휴업시작일자), 휴업시작일자, if_else(영업상태구분코드==&quot;02&quot;&amp; is.na(휴업시작일자), 최종수정시점, 휴업시작일자))) #확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;02&quot;, is.na(휴업시작일자)) ## # A tibble: 0 × 32 ## # ℹ 32 variables: 번호 &lt;chr&gt;, 개방서비스명 &lt;chr&gt;, 개방서비스아이디 &lt;chr&gt;, ## # 개방자치단체코드 &lt;chr&gt;, 관리번호 &lt;chr&gt;, 인허가일자 &lt;date&gt;, ## # 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, 영업상태명 &lt;chr&gt;, ## # 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, 폐업일자 &lt;date&gt;, ## # 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, … 인허가 취소 매장 결측치 확인 #취소 매장의 결측치 확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;04&quot;) %&gt;% summarise(sum(is.na(인허가취소일자))) #있음 ## # A tibble: 1 × 1 ## `sum(is.na(인허가취소일자))` ## &lt;int&gt; ## 1 33686 #영업상태구분코드가 04인 매장은 모두 폐업일자 없음. ciga_df &lt;- ciga_df %&gt;% mutate(인허가취소일자=if_else(영업상태구분코드 == &quot;04&quot; &amp; !is.na(인허가취소일자),인허가취소일자, if_else(영업상태구분코드 == &quot;04&quot; &amp; is.na(인허가취소일자),최종수정시점,인허가취소일자))) #다시 확인 ciga_df %&gt;% filter(영업상태구분코드==&quot;04&quot;&amp;is.na(인허가취소일자)) #없음 ## # A tibble: 0 × 32 ## # ℹ 32 variables: 번호 &lt;chr&gt;, 개방서비스명 &lt;chr&gt;, 개방서비스아이디 &lt;chr&gt;, ## # 개방자치단체코드 &lt;chr&gt;, 관리번호 &lt;chr&gt;, 인허가일자 &lt;date&gt;, ## # 인허가취소일자 &lt;date&gt;, 영업상태구분코드 &lt;chr&gt;, 영업상태명 &lt;chr&gt;, ## # 상세영업상태코드 &lt;chr&gt;, 상세영업상태명 &lt;chr&gt;, 폐업일자 &lt;date&gt;, ## # 휴업시작일자 &lt;date&gt;, 휴업종료일자 &lt;chr&gt;, 재개업일자 &lt;lgl&gt;, ## # 소재지전화 &lt;chr&gt;, 소재지면적 &lt;lgl&gt;, 소재지우편번호 &lt;chr&gt;, ## # 소재지전체주소 &lt;chr&gt;, 도로명전체주소 &lt;chr&gt;, 도로명우편번호 &lt;chr&gt;, … 연도변수 추가 ciga_df &lt;- ciga_df %&gt;% mutate(인허가연도 = year(as.Date(인허가일자, origin = &quot;1970-01-01&quot;)), 폐업연도 = year(as.Date(폐업일자, origin = &quot;1970-01-01&quot;)), 휴업시작연도 = year(as.Date(휴업시작일자, origin = &quot;1970-01-01&quot;)), 인허가취소연도 = year(as.Date(인허가취소일자, origin = &quot;1970-01-01&quot;)), 최종수정연도 = year(as.Date(최종수정시점, origin = &quot;1970-01-01&quot;))) 8.5 분석 8.5.1 연도별 담배소매점 수 추이 # Create a vector of years from 1990 to 2023 years &lt;- 1990:2023 # Create a data frame to store the results Opening_ciga_df &lt;- data.frame(year = years, open_stores = rep(0, length(years))) # Loop through each year for (i in 1:length(years)) { # Count the number of open stores in the current year open_stores &lt;- sum(ciga_df$인허가연도 &lt;= years[i] &amp; (is.na(ciga_df$폐업연도) | ciga_df$폐업연도 &gt;= years[i]) &amp; (is.na(ciga_df$휴업시작연도) | ciga_df$휴업시작연도 &gt;= years[i]) &amp; (is.na(ciga_df$인허가취소연도) | ciga_df$인허가취소연도 &gt;= years[i])) # Calculate the growth rate compared to the previous year growth_rate &lt;- ifelse(i == 1, 0, (open_stores - Opening_ciga_df[i-1, &quot;open_stores&quot;])/Opening_ciga_df[i-1, &quot;open_stores&quot;] * 100) # Store the results in the data frame Opening_ciga_df[i, &quot;open_stores&quot;] &lt;- open_stores Opening_ciga_df[i, &quot;growth_rate&quot;] &lt;- round(growth_rate,1) } # Print the result Opening_ciga_df ## year open_stores growth_rate ## 1 1990 18325 0.0 ## 2 1991 20880 13.9 ## 3 1992 23776 13.9 ## 4 1993 27533 15.8 ## 5 1994 31589 14.7 ## 6 1995 37448 18.5 ## 7 1996 43477 16.1 ## 8 1997 51689 18.9 ## 9 1998 87122 68.6 ## 10 1999 108865 25.0 ## 11 2000 130351 19.7 ## 12 2001 150997 15.8 ## 13 2002 164363 8.9 ## 14 2003 171196 4.2 ## 15 2004 176046 2.8 ## 16 2005 180188 2.4 ## 17 2006 183257 1.7 ## 18 2007 186359 1.7 ## 19 2008 187193 0.4 ## 20 2009 173645 -7.2 ## 21 2010 173268 -0.2 ## 22 2011 171660 -0.9 ## 23 2012 168109 -2.1 ## 24 2013 164288 -2.3 ## 25 2014 164242 0.0 ## 26 2015 165120 0.5 ## 27 2016 164595 -0.3 ## 28 2017 164003 -0.4 ## 29 2018 161502 -1.5 ## 30 2019 159460 -1.3 ## 31 2020 157846 -1.0 ## 32 2021 157130 -0.5 ## 33 2022 155617 -1.0 ## 34 2023 144020 -7.5 fig &lt;- plot_ly(Opening_ciga_df, x = ~year, y = ~open_stores, type = &#39;scatter&#39;, mode = &#39;lines&#39;) %&gt;% layout(title = &#39;Trends in the number of tobacco retail stores by year&#39;, xaxis = list(title = &#39;Year&#39;), yaxis = list(title = &#39;Number of Stores&#39;), plot_bgcolor = &quot;black&quot;, paper_bgcolor = &quot;black&quot;, font = list(color = &quot;white&quot;)) fig 8.5.2 연도별 담배소매점 인허가 및 폐업/취소/휴업 수 추이 # define the years from 1995 to 2023 years &lt;- seq(&quot;1952&quot;, &quot;2023&quot;, by = 1) # create an empty data frame to store the results result_ciga_df &lt;- data.frame(year = years, 인허가연도 = rep(0, length(years)), 폐업연도 = rep(0, length(years)), 휴업시작연도 = rep(0, length(years)), 인허가취소연도 = rep(0, length(years))) # loop through each year and calculate the frequency of the five variables for (i in 1:length(years)) { year &lt;- years[i] result_ciga_df[i, &quot;인허가&quot;] &lt;- sum(ciga_df$인허가연도 == year) result_ciga_df[i, &quot;폐업&quot;] &lt;- sum(ciga_df$폐업연도 == year, na.rm = T) result_ciga_df[i, &quot;휴업시작&quot;] &lt;- sum(ciga_df$휴업시작연도 == year, na.rm = T) result_ciga_df[i, &quot;인허가취소&quot;] &lt;- sum(ciga_df$인허가취소연도 == year, na.rm = T) } # print the results print(result_ciga_df) ## year 인허가연도 폐업연도 휴업시작연도 인허가취소연도 인허가 폐업 휴업시작 ## 1 1952 0 0 0 0 5 0 0 ## 2 1953 0 0 0 0 1 0 0 ## 3 1954 0 0 0 0 0 0 0 ## 4 1955 0 0 0 0 1 0 0 ## 5 1956 0 0 0 0 1 0 0 ## 6 1957 0 0 0 0 2 0 0 ## 7 1958 0 0 0 0 9 0 0 ## 8 1959 0 0 0 0 8 0 0 ## 9 1960 0 0 0 0 3 0 0 ## 10 1961 0 0 0 0 15 0 0 ## 11 1962 0 0 0 0 13 0 0 ## 12 1963 0 0 0 0 13 0 0 ## 13 1964 0 0 0 0 28 0 0 ## 14 1965 0 0 0 0 24 0 0 ## 15 1966 0 0 0 0 37 0 0 ## 16 1967 0 0 0 0 40 0 0 ## 17 1968 0 0 0 0 84 0 0 ## 18 1969 0 0 0 0 65 0 0 ## 19 1970 0 0 0 0 69 0 0 ## 20 1971 0 0 0 0 74 1 0 ## 21 1972 0 0 0 0 69 0 0 ## 22 1973 0 0 0 0 73 0 0 ## 23 1974 0 0 0 0 352 2 0 ## 24 1975 0 0 0 0 558 1 0 ## 25 1976 0 0 0 0 199 1 0 ## 26 1977 0 0 0 0 244 0 0 ## 27 1978 0 0 0 0 230 0 0 ## 28 1979 0 0 0 0 383 1 0 ## 29 1980 0 0 0 0 1439 1 0 ## 30 1981 0 0 0 0 725 0 0 ## 31 1982 0 0 0 0 547 0 0 ## 32 1983 0 0 0 0 815 0 0 ## 33 1984 0 0 0 0 791 0 0 ## 34 1985 0 0 0 0 1314 1 0 ## 35 1986 0 0 0 0 948 2 2 ## 36 1987 0 0 0 0 1210 1 1 ## 37 1988 0 0 0 0 1320 2 2 ## 38 1989 0 0 0 0 4240 9 1 ## 39 1990 0 0 0 0 2404 14 1 ## 40 1991 0 0 0 0 2569 21 0 ## 41 1992 0 0 0 0 2917 24 0 ## 42 1993 0 0 0 0 3781 27 1 ## 43 1994 0 0 0 0 4085 32 2 ## 44 1995 0 0 0 0 5893 32 0 ## 45 1996 0 0 0 0 6063 67 0 ## 46 1997 0 0 0 0 8296 89 4 ## 47 1998 0 0 0 0 35550 337 3 ## 48 1999 0 0 0 0 22108 479 1 ## 49 2000 0 0 0 0 22015 1696 52 ## 50 2001 0 0 0 0 22483 14112 269 ## 51 2002 0 0 0 0 28585 20406 241 ## 52 2003 0 0 0 0 28502 21099 276 ## 53 2004 0 0 0 0 27103 19926 250 ## 54 2005 0 0 0 0 25326 19211 188 ## 55 2006 0 0 0 0 23624 19095 169 ## 56 2007 0 0 0 0 23481 20616 223 ## 57 2008 0 0 0 0 23284 24248 324 ## 58 2009 0 0 0 0 21406 19037 254 ## 59 2010 0 0 0 0 22113 19841 393 ## 60 2011 0 0 0 0 21998 19879 520 ## 61 2012 0 0 0 0 19386 17604 533 ## 62 2013 0 0 0 0 16725 16075 507 ## 63 2014 0 0 0 0 18693 15757 543 ## 64 2015 0 0 0 0 19633 16624 450 ## 65 2016 0 0 0 0 18860 16350 541 ## 66 2017 0 0 0 0 18794 15371 579 ## 67 2018 0 0 0 0 16023 15002 631 ## 68 2019 0 0 0 0 15752 14350 484 ## 69 2020 0 0 0 0 15027 13227 489 ## 70 2021 0 0 0 0 14862 12785 452 ## 71 2022 0 0 0 0 13570 11951 705 ## 72 2023 0 0 0 0 3178 3275 167 ## 인허가취소 ## 1 0 ## 2 0 ## 3 0 ## 4 0 ## 5 0 ## 6 0 ## 7 0 ## 8 0 ## 9 0 ## 10 0 ## 11 0 ## 12 0 ## 13 0 ## 14 0 ## 15 0 ## 16 0 ## 17 0 ## 18 0 ## 19 0 ## 20 0 ## 21 0 ## 22 0 ## 23 0 ## 24 0 ## 25 0 ## 26 0 ## 27 0 ## 28 0 ## 29 0 ## 30 0 ## 31 0 ## 32 0 ## 33 0 ## 34 0 ## 35 0 ## 36 0 ## 37 0 ## 38 0 ## 39 0 ## 40 0 ## 41 0 ## 42 1 ## 43 0 ## 44 2 ## 45 17 ## 46 25 ## 47 25 ## 48 48 ## 49 94 ## 50 951 ## 51 1155 ## 52 1042 ## 53 1177 ## 54 1279 ## 55 1249 ## 56 1753 ## 57 10647 ## 58 3437 ## 59 3588 ## 60 2814 ## 61 2688 ## 62 2515 ## 63 2809 ## 64 2657 ## 65 2869 ## 66 2940 ## 67 2677 ## 68 2231 ## 69 2252 ## 70 2272 ## 71 2768 ## 72 723 result_ciga_df %&gt;% group_by(year) %&gt;% summarise(인허가, &quot;폐업/휴업/취소&quot;=폐업+휴업시작+인허가취소) ## # A tibble: 72 × 3 ## year 인허가 `폐업/휴업/취소` ## &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 1952 5 0 ## 2 1953 1 0 ## 3 1954 0 0 ## 4 1955 1 0 ## 5 1956 1 0 ## 6 1957 2 0 ## 7 1958 9 0 ## 8 1959 8 0 ## 9 1960 3 0 ## 10 1961 15 0 ## # ℹ 62 more rows 시각화 #library(plotly) result_ciga_df_2 &lt;- result_ciga_df %&gt;% group_by(year) %&gt;% summarise(인허가, &quot;폐업_휴업_취소&quot;=폐업+휴업시작+인허가취소) plot_ly(data = result_ciga_df_2, x = ~year) %&gt;% add_lines(y = ~인허가, name = &quot;인허가&quot;, line = list(color = &quot;#1f77b4&quot;)) %&gt;% add_lines(y = ~`폐업_휴업_취소`, name = &quot;폐업/휴업/취소&quot;, line = list(color = &quot;#d62728&quot;)) %&gt;% layout(title = &quot;연도별 인허가 및 폐업/휴업/취소 추이&quot;, xaxis = list(title = &quot;연도&quot;), yaxis = list(title = &quot;누적 수&quot;), plot_bgcolor = &quot;black&quot;, paper_bgcolor = &quot;black&quot;, font = list(color = &quot;white&quot;)) 8.5.3 지역별 담배소매점 수 ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% group_by(시도명) %&gt;% summarise(&quot;개수&quot;=n()) %&gt;% arrange(desc(개수)) ## # A tibble: 17 × 2 ## 시도명 개수 ## &lt;chr&gt; &lt;int&gt; ## 1 경기도 29014 ## 2 서울특별시 18422 ## 3 경상북도 10428 ## 4 경상남도 9559 ## 5 부산광역시 8625 ## 6 충청남도 7803 ## 7 인천광역시 7562 ## 8 전라남도 7555 ## 9 강원도 7448 ## 10 대구광역시 6639 ## 11 전라북도 6549 ## 12 충청북도 6319 ## 13 광주광역시 4612 ## 14 대전광역시 4300 ## 15 울산광역시 3740 ## 16 제주특별자치도 2799 ## 17 세종특별자치시 861 지도 시각화 (주)지오서비스의 블로그(click)에서 제공하는 대한민국 최신 행정구역(SHP) 활용 rnaturalearth, rworldmap 등 지도 시각화 패키지 있으나 시군구 행정구역까지는 지원하지 않음 shp 파일 불러올 때 ‘euc-kr’ 설정! #library(rgdal) #library(sp) map = readOGR(&quot;C:/Users/wschoi/Desktop/TOY/[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사/지방인허가데이터/대한민국 행정구역_시도(2023.02)/ctp_rvn.shp&quot;, encoding = &#39;euc-kr&#39;) ## OGR data source with driver: ESRI Shapefile ## Source: &quot;C:\\Users\\wschoi\\Desktop\\TOY\\[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사\\지방인허가데이터\\대한민국 행정구역_시도(2023.02)\\ctp_rvn.shp&quot;, layer: &quot;ctp_rvn&quot; ## with 17 features ## It has 3 fields map_2 = readOGR(&quot;C:/Users/wschoi/Desktop/TOY/[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사/지방인허가데이터/대한민국 행정구역_시군구(2023.02)/sig.shp&quot;, encoding = &#39;euc-kr&#39;) ## OGR data source with driver: ESRI Shapefile ## Source: &quot;C:\\Users\\wschoi\\Desktop\\TOY\\[ITOCHU] 프로틴 파우더 시장 이해를 위한 소비자조사\\지방인허가데이터\\대한민국 행정구역_시군구(2023.02)\\sig.shp&quot;, layer: &quot;sig&quot; ## with 250 features ## It has 3 fields class(map) ## [1] &quot;SpatialPolygonsDataFrame&quot; ## attr(,&quot;package&quot;) ## [1] &quot;sp&quot; slotNames(map) #5개의 슬롯 ## [1] &quot;data&quot; &quot;polygons&quot; &quot;plotOrder&quot; &quot;bbox&quot; &quot;proj4string&quot; df_map_info = map@data head(df_map_info, 10) #확인 ## CTPRVN_CD CTP_ENG_NM CTP_KOR_NM ## 0 11 Seoul 서울특별시 ## 1 26 Busan 부산광역시 ## 2 27 Daegu 대구광역시 ## 3 28 Incheon 인천광역시 ## 4 29 Gwangju 광주광역시 ## 5 30 Daejeon 대전광역시 ## 6 31 Ulsan 울산광역시 ## 7 36 Sejong-si 세종특별자치시 ## 8 41 Gyeonggi-do 경기도 ## 9 42 Gangwon-do 강원도 #library(ggplot2) #install.packages(&quot;maps&quot;) #library(maps) # 지도 데이터 불러오기 df_map = fortify(map) ## Regions defined for each Polygons head(df_map) ## long lat order hole piece id group ## 1 966987.225863826 1941110.94614564 1 FALSE 1 0 0.1 ## 2 966987.119325639 1941111.02392769 2 FALSE 1 0 0.1 ## 3 966961.289674760 1941129.62268257 3 FALSE 1 0 0.1 ## 4 966930.611330032 1941164.55371284 4 FALSE 1 0 0.1 ## 5 966902.122499466 1941188.22650337 5 FALSE 1 0 0.1 ## 6 966885.976930619 1941200.74408150 6 FALSE 1 0 0.1 df_map_info[, &quot;id&quot;] = (1:nrow(df_map_info)) - 1 df_map_info ## CTPRVN_CD CTP_ENG_NM CTP_KOR_NM id ## 0 11 Seoul 서울특별시 0 ## 1 26 Busan 부산광역시 1 ## 2 27 Daegu 대구광역시 2 ## 3 28 Incheon 인천광역시 3 ## 4 29 Gwangju 광주광역시 4 ## 5 30 Daejeon 대전광역시 5 ## 6 31 Ulsan 울산광역시 6 ## 7 36 Sejong-si 세종특별자치시 7 ## 8 41 Gyeonggi-do 경기도 8 ## 9 42 Gangwon-do 강원도 9 ## 10 43 Chungcheongbuk-do 충청북도 10 ## 11 44 Chungcheongnam-do 충청남도 11 ## 12 45 Jeollabuk-do 전라북도 12 ## 13 46 Jellanam-do 전라남도 13 ## 14 47 Gyeongsangbuk-do 경상북도 14 ## 15 48 Gyeongsangnam-do 경상남도 15 ## 16 50 Jeju-do 제주특별자치도 16 # 데이터 전처리 ciga_region_df &lt;- as.data.frame(ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot;) %&gt;% group_by(region=시도명) %&gt;% summarise(&quot;개수&quot;=n())) df_map$id &lt;- as.numeric(df_map$id) df_map &lt;- left_join(df_map, df_map_info, by = &#39;id&#39;) names(df_map)[names(df_map) == &quot;CTP_KOR_NM&quot;] &lt;- &quot;region&quot; df_map_select &lt;- select(df_map, region, long, lat, group, region) left_join(ciga_region_df, df_map_select,by = &quot;region&quot;) %&gt;% ggplot() + geom_polygon(aes(x=long, y=lat, group=group, fill = 개수)) + scale_fill_gradient(low = &quot;#FDE0DD&quot;, high = &quot;#B30000&quot;) + ggtitle(&quot;대한민국 시도별 담배소매업 개수&quot;) -&gt; p ggplotly(p) 8.5.4 시군구별 담배소매점 수 ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot; &amp; is.na(폐업일자)&amp;is.na(인허가취소일자)) %&gt;% group_by(시도명, 시군구명) %&gt;% summarise(&quot;개수&quot;=n()) %&gt;% arrange(desc(개수)) ## `summarise()` has grouped output by &#39;시도명&#39;. You can override using the ## `.groups` argument. ## # A tibble: 229 × 3 ## # Groups: 시도명 [17] ## 시도명 시군구명 개수 ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 경상남도 창원시 2712 ## 2 충청북도 청주시 2697 ## 3 경기도 수원시 2106 ## 4 경기도 화성시 2039 ## 5 전라북도 전주시 1956 ## 6 충청남도 천안시 1877 ## 7 경기도 용인시 1866 ## 8 경기도 고양시 1828 ## 9 경기도 평택시 1772 ## 10 경상북도 포항시 1766 ## # ℹ 219 more rows #서울 각 구별 담배소매점 개수 ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot; &amp; 시도명==&quot;서울특별시&quot;) %&gt;% group_by(시도명, 시군구명) %&gt;% summarise(&quot;개수&quot;=n()) %&gt;% arrange(desc(개수)) ## `summarise()` has grouped output by &#39;시도명&#39;. You can override using the ## `.groups` argument. ## # A tibble: 25 × 3 ## # Groups: 시도명 [1] ## 시도명 시군구명 개수 ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 서울특별시 영등포구 1132 ## 2 서울특별시 송파구 1109 ## 3 서울특별시 강남구 1047 ## 4 서울특별시 강서구 930 ## 5 서울특별시 구로구 876 ## 6 서울특별시 동대문구 859 ## 7 서울특별시 중구 825 ## 8 서울특별시 강동구 807 ## 9 서울특별시 성북구 788 ## 10 서울특별시 서초구 778 ## # ℹ 15 more rows #경기도 각 시별 담배소매점 개수 ciga_df %&gt;% filter(영업상태구분코드==&quot;01&quot; &amp; 시도명==&quot;경기도&quot;) %&gt;% group_by(시도명, 시군구명) %&gt;% summarise(&quot;개수&quot;=n()) %&gt;% arrange(desc(개수)) ## `summarise()` has grouped output by &#39;시도명&#39;. You can override using the ## `.groups` argument. ## # A tibble: 31 × 3 ## # Groups: 시도명 [1] ## 시도명 시군구명 개수 ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 경기도 수원시 2106 ## 2 경기도 화성시 2039 ## 3 경기도 용인시 1866 ## 4 경기도 고양시 1828 ## 5 경기도 평택시 1772 ## 6 경기도 성남시 1625 ## 7 경기도 부천시 1414 ## 8 경기도 남양주 1397 ## 9 경기도 안산시 1394 ## 10 경기도 파주시 1292 ## # ℹ 21 more rows 8.5.5 폐업장 평균 영업 기간 폐업장 평균 영업 기간 폐업/취소/휴업 등 비영업인 경우 케이스의 평균 ciga_df %&gt;% filter(!is.na(폐업일자), !is.na(인허가일자), is.na(인허가취소일자)) %&gt;% mutate(폐업일자 = ifelse(is.na(폐업일자), Sys.Date(), 폐업일자)) %&gt;% mutate(평균업지속기간_연도 = as.numeric(difftime(as.Date(폐업일자, origin = &quot;1970-01-01&quot;), as.Date(인허가일자), units = &quot;days&quot;))/365) %&gt;% group_by(폐업연도) %&gt;% summarise(평균업기간 = mean(평균업지속기간_연도, na.rm = TRUE)) ## # A tibble: 45 × 2 ## 폐업연도 평균업기간 ## &lt;dbl&gt; &lt;dbl&gt; ## 1 1971 0 ## 2 1974 0 ## 3 1975 0 ## 4 1976 0 ## 5 1979 0 ## 6 1980 0 ## 7 1985 0 ## 8 1986 2.32 ## 9 1987 8.45 ## 10 1988 4.76 ## # ℹ 35 more rows "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
